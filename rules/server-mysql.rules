# Copyright 2001-2022 Sourcefire, Inc. All Rights Reserved.
#
# This file contains (i) proprietary rules that were created, tested and certified by
# Sourcefire, Inc. (the "VRT Certified Rules") that are distributed under the VRT
# Certified Rules License Agreement (v 2.0), and (ii) rules that were created by
# Sourcefire and other third parties (the "GPL Rules") that are distributed under the
# GNU General Public License (GPL), v2.
# 
# The VRT Certified Rules are owned by Sourcefire, Inc. The GPL Rules were created
# by Sourcefire and other third parties. The GPL Rules created by Sourcefire are
# owned by Sourcefire, Inc., and the GPL Rules not created by Sourcefire are owned by
# their respective creators. Please see http://www.snort.org/snort/snort-team/ for a
# list of third party owners and their respective copyrights.
# 
# In order to determine what rules are VRT Certified Rules or GPL Rules, please refer
# to the VRT Certified Rules License Agreement (v2.0).
#
#--------------------
# SERVER-MYSQL RULES
#--------------------

alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL create function buffer overflow attempt"; flow:to_server,established; content:"|03|create"; offset:4; nocase; pcre:"/\x03create\s+(aggregate\s+)*function\s+\S{50}/smi"; metadata:service mysql; reference:bugtraq,14509; reference:cve,2005-2558;  sid:4649; rev:7;)

alert tcp $EXTERNAL_NET any -> $HOME_NET $HTTP_PORTS (msg:"SERVER-MYSQL MaxDB WebSQL wppassword buffer overflow default port"; flow:to_server,established; content:"websql?logon"; nocase; content:"wqPassword="; distance:0; nocase; pcre:"/wqPassword=[^\r\n\x26]{294}/i"; metadata:service http; reference:bugtraq,12265; reference:cve,2005-0111; reference:url,attack.mitre.org/techniques/T1078;  sid:3519; rev:13;)
alert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS (msg:"SERVER-MYSQL MaxDB WebSQL wppassword buffer overflow"; flow:to_server,established; content:"websql?logon"; nocase; content:"wqPassword="; distance:0; nocase; pcre:"/wqPassword=[^\r\n\x26]{294}/i"; metadata:service http; reference:bugtraq,12265; reference:cve,2005-0111;  sid:3518; rev:11;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL MySQL/MariaDB Server geometry query envelope object integer overflow attempt"; flow:to_server,established; content:"select envelope(0x"; nocase; content:"ffffffff)|3B|"; within:50; distance:15; metadata:policy max-detect-ips drop, service mysql; reference:cve,2013-1861;  sid:52423; rev:1;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL MySQL/MariaDB Server geometry query integer overflow attempt"; flow:to_server,established; content:"geometryn("; fast_pattern; nocase; content:"0x"; distance:0; nocase; content:"0007000000010000000003000000ffffffff"; within:36; distance:8; metadata:policy max-detect-ips drop, service mysql; reference:cve,2013-1861;  sid:44674; rev:2;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL Multiple SQL products privilege escalation attempt"; flow:to_server,established; content:"set "; content:"global "; within:15; content:"general_log_file"; within:35; content:"/my.cnf"; within:100; pcre:"/set\s+global\s+general_log_file\s+=\s+[\x22\x27][^\x22\x27]{0,100}my\.cnf[\x22\x27]/si"; metadata:policy max-detect-ips drop, policy security-ips drop, service http; reference:cve,2016-6662;  sid:40254; rev:2;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL Multiple SQL products privilege escalation attempt"; flow:to_server,established; content:"select "; nocase; content:"malloc_lib="; within:100; nocase; content:".so"; within:50; nocase; pcre:"/select [\x22\x27][^\x22\x27]{0,100}malloc_lib=\S+\.so[\x22\x27]/si"; metadata:policy max-detect-ips drop, policy security-ips drop, service http; reference:cve,2016-6662;  sid:40253; rev:2;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL MySQL/MariaDB Server geometry query object integer overflow attempt"; flow:to_server,established; content:"geometryn("; fast_pattern; nocase; content:"0x"; distance:0; byte_test:8,>=,65535,54,relative,string,hex; metadata:policy max-detect-ips drop, service mysql; reference:cve,2013-1861;  sid:33637; rev:4;)
alert tcp $EXTERNAL_NET any -> $HOME_NET 3306 (msg:"SERVER-MYSQL Oracle MySQL Server XPath memory Corruption attempt"; flow:to_server,established; content:"substring("; nocase; content:",.."; within:7; metadata:impact_flag red, policy balanced-ips drop, policy max-detect-ips drop, policy security-ips drop; reference:cve,2014-0384;  sid:32533; rev:2;)
alert tcp $EXTERNAL_NET 3306 -> $HOME_NET any (msg:"SERVER-MYSQL MySQL/MariaDB mysql.cc buffer overflow attempt"; flow:to_client,established; content:"|01 00 00 01 01 27 00 00 02|"; depth:9; content:"@@version_comment"; fast_pattern; isdataat:460,relative; metadata:policy max-detect-ips drop, service mysql; reference:bugtraq,65298; reference:cve,2014-0001;  sid:31570; rev:3;)
alert tcp $SQL_SERVERS 3306 -> $EXTERNAL_NET any (msg:"SERVER-MYSQL Oracle MySQL user enumeration attempt"; flow:to_client,established,no_stream; content:"|15 04|"; depth:2; offset:5; content:"Access denied for user"; fast_pattern:only; detection_filter:track by_dst,count 10, seconds 2; metadata:policy max-detect-ips drop, service mysql; reference:bugtraq,56766; reference:cve,2012-5615;  sid:24908; rev:7;)

alert tcp any any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL MySQL/MariaDB client authentication bypass attempt"; flow:to_server,established,no_stream; content:"|00 00 01|"; depth:3; offset:1; fast_pattern; content:"|00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|"; within:23; distance:9; detection_filter:track by_src,count 100, seconds 100; metadata:policy max-detect-ips drop, service mysql; reference:cve,2012-2122;  sid:23115; rev:9;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL create function mysql.func arbitrary library injection attempt"; flow:to_server,established; content:"|03|"; depth:5; content:"mysql.func"; distance:0; nocase; pcre:"/(INSERT|UPDATE)\s*[\s\w]*((mysql\.)?func)[^\r\n]+values\s*\([^\)]+\x2c[\x22\x27][^\x22\x27]*\x2f/i"; metadata:policy max-detect-ips drop, service mysql; reference:bugtraq,12781; reference:cve,2005-0710;  sid:17412; rev:9;)

alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL client authentication bypass attempt"; flow:to_server,established; flowbits:isset,mysql.server_greeting; content:"|01|"; depth:1; offset:3; byte_test:1,&,0x80,4; byte_test:1,!&,0x02,4; content:"|00 14 00|"; offset:9; metadata:policy max-detect-ips drop, policy security-ips drop, service mysql; reference:bugtraq,10655; reference:cve,2004-0627; reference:nessus,12639; reference:url,www.nextgenss.com/advisories/mysql-authbypass.txt;  sid:3668; rev:14;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL protocol 41 client authentication bypass attempt"; flow:to_server,established; flowbits:isset,mysql.server_greeting; content:"|01|"; depth:1; offset:3; byte_test:1,&,0x80,4; byte_test:1,&,0x02,4; content:"|00 14 00|"; offset:36; metadata:policy max-detect-ips drop, policy security-ips drop, service mysql; reference:bugtraq,10655; reference:cve,2004-0627; reference:nessus,12639; reference:url,www.nextgenss.com/advisories/mysql-authbypass.txt;  sid:3667; rev:12;)
alert tcp $SQL_SERVERS 3306 -> $EXTERNAL_NET any (msg:"SERVER-MYSQL server greeting"; flow:to_client,established; content:"|00|"; depth:1; offset:3; flowbits:set,mysql.server_greeting; flowbits:noalert; metadata:policy max-detect-ips alert, policy security-ips alert, service mysql; reference:bugtraq,10655; reference:cve,2004-0627; reference:nessus,12639; reference:url,www.nextgenss.com/advisories/mysql-authbypass.txt;  sid:3665; rev:12;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL create function access attempt"; flow:to_server,established; content:"|03|create"; offset:4; nocase; pcre:"/\x03create\s+(aggregate\s+)*function/smi"; metadata:policy max-detect-ips drop, service mysql; reference:bugtraq,12781; reference:cve,2005-0709;  sid:3528; rev:12;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL 4.0 root login attempt"; flow:to_server,established; content:"|01|"; depth:1; offset:3; content:"root|00|"; within:5; distance:5; nocase; metadata:ruleset community, service mysql;  sid:3456; rev:9;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL show databases attempt"; flow:to_server,established; content:"|0F 00 00 00 03|show databases"; fast_pattern:only; metadata:ruleset community, service mysql;  sid:1776; rev:9;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL root login attempt"; flow:to_server,established; content:"|0A 00 00 01 85 04 00 00 80|root|00|"; fast_pattern:only; metadata:ruleset community, service mysql;  sid:1775; rev:9;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL Dell OpenManage Network Manager remote code execution attempt"; flow:to_server,established; content:"root|00 14 59 C6 5D D4 0E 42 E6 F6 A6 A1 D0 97 33 C1 A0 45 58 A8 13 81|"; fast_pattern:only; metadata:policy max-detect-ips drop, service mysql; reference:cve,2018-15767; reference:cve,2018-15768;  sid:59695; rev:1;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL Dell OpenManage Network Manager remote code execution attempt"; flow:to_server,established; content:"|03|insert into "; depth:13; offset:4; content:"<%"; within:50; content:"request.getParameter"; metadata:policy max-detect-ips drop, service mysql; reference:cve,2018-15767; reference:cve,2018-15768;  sid:59694; rev:1;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL Dell OpenManage Network Manager remote code execution attempt"; flow:to_server,established; content:"|03|select |2A| from user into outfile |22|/tmp/poc.txt|22|"; fast_pattern:only; metadata:policy max-detect-ips drop, service mysql; reference:cve,2018-15767; reference:cve,2018-15768;  sid:59693; rev:1;)
alert tcp $EXTERNAL_NET any -> $SQL_SERVERS 3306 (msg:"SERVER-MYSQL Dell OpenManage Network Manager remote code execution attempt"; flow:to_server,established; content:"root|00 14 82 B9 62 E9 8F E4 9E 73 19 19 63 A3 BF 00 2E D7 65 3C 9C 47|"; fast_pattern:only; metadata:policy max-detect-ips drop, service mysql; reference:cve,2018-15767; reference:cve,2018-15768;  sid:59692; rev:1;)
